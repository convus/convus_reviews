<% ratings ||= @ratings %>
<% skip_sortable ||= false %>
<% filter_links ||= !skip_sortable %>

<% table_classes = "table table-sm break-words max-w-full" %>
<div class="">
  <table class="<%= table_classes %>">
    <thead class="sortable">
      <tr>
        <th>
          <%= sortable "created_at", "Rated", skip_sortable: skip_sortable %>
        </th>
        <th>
          <%= sortable "display_name", "Article", skip_sortable: skip_sortable, class: "sortable-link-narrow" %>
          <% if !skip_sortable %>
            <%= sortable "user_id", skip_sortable: skip_sortable, class: "sortable-link-narrow" %>
          <% end %>
        </th>
        <th>Version</th>
        <% if display_dev_info? %>
          <th class="only-dev-visible">
            <%= sortable "version_integer", "Version #", skip_sortable: skip_sortable %>
          </th>
        <% end %>
        <th>
          <%= sortable "meta", "Meta?", skip_sortable: skip_sortable %>
        </th>
        <th>Keywords?</th>
      </tr>
    </thead>
    <tbody>
      <% ratings.each do |rating| %>
        <tr>
          <td>
            <% if display_dev_info? %><code class="only-dev-visible-small ratingId"><%= rating.id %></code><% end %>
            <%= link_to l(rating.created_at, format: :convert_time), admin_rating_path(rating), class: "convertTime" %>
          </td>
          <td class="max-w-md maxWScreen">
            <% rating_text = "missing url" if rating.missing_url? %>
            <% rating_text ||= rating.display_name %>
            <%= link_to rating_text, admin_citation_path(rating.citation), class: "mr-1" %>
            <small class="inline-block less-strong mr-1">
              <%= link_to rating.user&.username, url_for(sortable_params.merge(user: rating.user_id)) %>
            </small>
            <%= link_to display_icon("link"), rating.citation_url, class: "mr-2" %>
            <span class="">
              <%= agreement_display(rating.agreement, link: filter_links) %>
              <%= quality_display(rating.quality, link: filter_links) %>
              <%= learned_something_display(rating.learned_something?, link: filter_links) %>
              <%= changed_opinion_display(rating.changed_opinion?, link: filter_links) %>
              <%= significant_factual_error_display(rating.significant_factual_error?, link: filter_links) %>
              <%= not_finished_display(rating.not_finished?, link: filter_links) %>
            </span>
            <span class="block text-sm less-strong"><%= rating.topic_names.join(", ") %></span>
          </td>
          <td>
            <small><%= rating.source %></small>
          </td>
          <% if display_dev_info? %>
            <td>
              <small><%= rating.version_integer %></small>

            </td>
          <% end %>
          <td class="table-cell-check">
            <%= check_mark if rating.metadata_present? %>
          </td>
          <td class="table-cell-check">
            <%= check_mark if rating.citation_metadata_attributes[:keywords]&.any? %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
